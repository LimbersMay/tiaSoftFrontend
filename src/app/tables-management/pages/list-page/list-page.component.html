<!-- Header -->
<div class="grid">
  <div class="col-12">
    <div class="card px-6 py-6">
      <p-toolbar styleClass="mb-4">
        <ng-template pTemplate="left">
          <div class="my-2">
            <p-button
              label="Crear mesa"
              icon="pi pi-plus"
              class="p-button-primary w-full"
              (click)="showDialog()"
            ></p-button>
          </div>
        </ng-template>
      </p-toolbar>

      <p-table
        [value]="tables"
        styleClass="p-datatable-striped"
        [scrollable]="true"
        [scrollHeight]="'calc(100vh - 200px)'"
        [paginator]="true"
        [rows]="5"
        [globalFilterFields]="['name', 'paymentAuthorizedByUser.username', 'user.username', 'area.name', 'tableStatus.name']"
        responsiveLayout="scroll"
        dataKey="tableId"
      >
        <ng-template pTemplate="caption">
          <div class="flex flex-column md:flex-row md:justify-content-between md:align-items-center">
            <h5 class="m-0">Gesti√≥n de mesas</h5>
          </div>
        </ng-template>

        <ng-template pTemplate="header">
          <tr>
            <th style="width: 15%">
              <div class="flex align-items-center">
                Nombre
                <p-columnFilter type="text" field="name" display="menu"/>
              </div>
            </th>
            <th style="width: 15%">
              <div class="flex align-items-center">
                Autorizado por
                <p-columnFilter field="paymentAuthorizedByUser.userId" matchMode="in" display="menu"
                                [showMatchModes]="false"
                                [showOperator]="false" [showAddButton]="false">
                  <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                    <p-multiSelect [showHeader]="false" [ngModel]="value" [options]="waiters" placeholder="Cualquiera"
                                   (onChange)="filter($event.value)" optionLabel="username" optionValue="userId">
                      <ng-template let-option pTemplate="item">
                        <div class="inline-block vertical-align-middle">
                          <span class="ml-1 mt-1">{{ option.username }}</span>
                        </div>
                      </ng-template>
                    </p-multiSelect>
                  </ng-template>
                </p-columnFilter>
              </div>
            </th>
            <th style="width: 10%">
              <div class="flex align-items-center">
                Total
                <p-columnFilter type="numeric" field="customers" display="menu"/>
              </div>
            </th>
            <th style="width: 15%">
              <div class="flex align-items-center">
                Mesero
                <p-columnFilter field="user.userId" matchMode="in" display="menu" [showMatchModes]="false"
                                [showOperator]="false" [showAddButton]="false">
                  <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                    <p-multiSelect [showHeader]="false" [ngModel]="value" [options]="waiters" placeholder="Cualquiera"
                                   (onChange)="filter($event.value)" optionLabel="username" optionValue="userId">
                      <ng-template let-option pTemplate="item">
                        <div class="inline-block vertical-align-middle">
                          <span class="ml-1 mt-1">{{ option.username }}</span>
                        </div>
                      </ng-template>
                    </p-multiSelect>
                  </ng-template>
                </p-columnFilter>
              </div>
            </th>
            <th style="width: 10%">
              <div class="flex align-items-center">
                Area
                <p-columnFilter field="area.areaId" matchMode="in" display="menu" [showMatchModes]="false"
                                [showOperator]="false" [showAddButton]="false">
                  <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                    <p-multiSelect [showHeader]="false" [ngModel]="value" [options]="areas" placeholder="Cualquiera"
                                   (onChange)="filter($event.value)" optionLabel="name" optionValue="areaId">
                      <ng-template let-option pTemplate="item">
                        <div class="inline-block vertical-align-middle">
                          <span class="ml-1 mt-1">{{ option.name }}</span>
                        </div>
                      </ng-template>
                    </p-multiSelect>
                  </ng-template>
                </p-columnFilter>
              </div>
            </th>
            <th style="width: 15%">
              <div class="flex align-items-center">
                Estado
                <p-columnFilter field="tableStatus.tableStatusId" matchMode="in" display="menu" [showMatchModes]="false"
                                [showOperator]="false" [showAddButton]="false">
                  <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                    <p-multiSelect [showHeader]="false" [ngModel]="value" [options]="tableStatuses"
                                   placeholder="Cualquiera"
                                   (onChange)="filter($event.value)" optionLabel="name" optionValue="tableStatusId">
                      <ng-template let-option pTemplate="item">
                        <div class="inline-block vertical-align-middle">
                          <span class="ml-1 mt-1">{{ option.name }}</span>
                        </div>
                      </ng-template>
                    </p-multiSelect>
                  </ng-template>
                </p-columnFilter>
              </div>
            </th>
            <th style="width: 17%">Acciones</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-table>
          <tr>
            <td>
        <span class="p-column-title font-bold">
          Nombre
        </span>
              {{ table.name }}
            </td>
            <td>
        <span class="p-column-title">
          Autorizado por
        </span>
              {{ table.paymentAuthorizedByUser?.username }}
            </td>
            <td>
        <span class="p-column-title">
          Total
        </span>
              299$
            </td>
            <td>
        <span class="p-column-title">
          Mesero
        </span>
              <div class="flex gap-2 font-bold">
                {{ table.user.username }}
              </div>
            </td>
            <td>
        <span class="p-column-title">
          Area
        </span>
              <div class="flex gap-2">
                {{ table.area.name }}
              </div>
            </td>
            <td>
        <span class="p-column-title">
          Estado
        </span>
              <div class="flex gap-2">
                <p-tag [severity]="getStatusColor(table.tableStatus.name)">
                  {{ table.tableStatus.name }}
                </p-tag>
              </div>
            </td>
            <td>
        <span class="p-column-title">
          Acciones
        </span>

              <p-menu #menu [model]="items" [popup]="true" appendTo="body"/>
              <p-button (onClick)="menu.toggle($event); setSelectedTable(table)" icon="pi pi-ellipsis-v"/>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</div>

<!-- Dialog -->
<tables-edit-table
  [display]="display"
  [table]="selectedTable"
  [areas]="areas"
  [onShowDialog]="onShowDialog"
  (displayChange)="closeDialog($event)"
/>

<tables-payment-authorization
  [display]="displayRequestPaymentAuthorization"
  [table]="selectedTable"
  (displayChange)="closeRequestPaymentAuthorizationDialog($event)"
  (authorizePayment)="authorizePayment($event)"
/>

<tables-print-bill
  [display]="displayWhereToPrintTicket"
  (displayChange)="closeWhereToPrintTicketDialog($event)"
/>

<tables-create-order
  [display]="displayCreateAccount"
  (displayChange)="closeCreateOrderDialog($event)"
  [table]="selectedTable"
  [onShowDialog]="onShowCreateOrderDialog"
/>

<!-- TOAST -->
<p-toast position="top-right"></p-toast>
